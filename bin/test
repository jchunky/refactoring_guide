#!/bin/zsh
# Test runner script for refactoring_guide project
# This script runs all tests for the specified version.
#
# Usage:
#   bin/test <version>
#
# Examples:
#   bin/test v0              # Test original (v0) code
#   bin/test v1              # Test v1 version

source ~/.zshrc

if [ -z "$1" ]; then
  echo "Usage: bin/test <version>"
  echo ""
  echo "Examples:"
  echo "  bin/test v0"
  echo "  bin/test v1"
  echo ""
  echo "Available versions:"
  ls -d lib/*/ | xargs -n1 basename | sed 's/^/  /'
  exit 1
fi

VERSION=$1
export VERSION

echo "=== Refactoring Guide Test Runner ==="
echo "Testing version: $VERSION"
echo ""

# Check if version directory exists
if [ ! -d "lib/${VERSION}" ]; then
  echo "Error: No implementation directory found for version '$VERSION'"
  echo ""
  echo "Available versions:"
  ls -d lib/*/ | xargs -n1 basename | sed 's/^/  /'
  exit 1
fi

bundle exec rake test

exit_code=$?

echo ""
echo "=== Test run complete (version: $VERSION) ==="
exit $exit_code
