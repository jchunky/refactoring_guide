#!/bin/zsh
# Test runner script for refactoring_guide project
# This script runs all tests for the specified version.
#
# Usage:
#   bin/test                 # Test 'original' version (default)
#   bin/test original        # Test original version
#   bin/test v1              # Test v1 version
#   VERSION=v1 bin/test      # Alternative syntax

source ~/.zshrc

# Use command line argument or environment variable, default to 'original'
VERSION=${1:-${VERSION:-original}}
export VERSION

echo "=== Refactoring Guide Test Runner ==="
echo "Testing version: $VERSION"
echo ""

# Check if version directory exists
if [ ! -d "lib/${VERSION}" ]; then
  echo "Error: No implementation directory found for version '$VERSION'"
  echo ""
  echo "Available versions:"
  ls -d lib/*/ | xargs -n1 basename | sed 's/^/  /'
  exit 1
fi

bundle exec rake test

exit_code=$?

echo ""
echo "=== Test run complete (version: $VERSION) ==="
exit $exit_code
