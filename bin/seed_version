#!/bin/bash
# Seed a new version of kata code by copying from a source version
#
# Usage:
#   bin/seed_version <source> <target>
#
# Examples:
#   bin/seed_version v0 v22        # v0 → v22
#   bin/seed_version v11 v12       # v11 → v12

if [ $# -ne 2 ]; then
  echo "Usage: bin/seed_version <source> <target>"
  echo ""
  echo "Examples:"
  echo "  bin/seed_version v0 v22        # v0 → v22"
  echo "  bin/seed_version v11 v12       # v11 → v12"
  echo ""
  echo "Available versions:"
  ls -d lib/*/ | xargs -n1 basename | sed 's/^/  /'
  exit 1
fi

SOURCE=$1
VERSION=$2

SOURCE_DIR="lib/${SOURCE}"
TARGET_DIR="lib/${VERSION}"

if [ ! -d "$SOURCE_DIR" ]; then
  echo "Error: Source directory '$SOURCE_DIR' does not exist."
  echo ""
  echo "Available versions:"
  ls -d lib/*/ | xargs -n1 basename | sed 's/^/  /'
  exit 1
fi

mkdir -p "$TARGET_DIR"

echo "Copying from ${SOURCE} → ${VERSION}"
echo ""

for source_file in "$SOURCE_DIR"/*.rb; do
  [ -f "$source_file" ] || continue
  base=$(basename "$source_file")
  target="${TARGET_DIR}/${base}"
  cp "$source_file" "$target"
  echo "Created $target"
done

# Always create empty prompt.md and plan.md for the new version
touch "${TARGET_DIR}/prompt.md"
echo "Created ${TARGET_DIR}/prompt.md (empty)"

touch "${TARGET_DIR}/plan.md"
echo "Created ${TARGET_DIR}/plan.md (empty)"
